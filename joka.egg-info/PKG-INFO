Metadata-Version: 2.4
Name: joka
Version: 0.1.0
Summary: Joka - MySQL Migration Tool
Requires-Python: >=3.13
Description-Content-Type: text/markdown
Requires-Dist: asyncmy>=0.2.10
Requires-Dist: build>=1.3.0
Requires-Dist: cryptography>=46.0.3
Requires-Dist: dotenv>=0.9.9
Requires-Dist: greenlet>=3.3.0
Requires-Dist: pydantic>=2.12.5
Requires-Dist: rich>=14.2.0
Requires-Dist: sqlalchemy>=2.0.44
Requires-Dist: typer>=0.20.0

# Joka

Lightweight Typer-based CLI for running sequential SQL migrations against a MySQL/MariaDB database using asyncio + SQLAlchemy.

## Prerequisites
- Python 3.13+
- A reachable database URL that works with `asyncmy`, e.g. `mysql+asyncmy://user:pass@host:3306/dbname`
- A migrations folder (defaults to `devops/db/migrations`)

## Setup
- Clone the repo and install dependencies:
  - With uv: `uv sync`
  - With pip: `python -m venv .venv && source .venv/bin/activate && pip install -e .`
- Create an `.env` file with at least:
  ```
  DATABASE_URL=mysql+asyncmy://user:pass@host:3306/dbname
  ```
- Create your migrations directory if it does not exist (default `devops/db/migrations`).

## Writing migrations
- File naming pattern: `YYMMDDHHMMSS_description.sql` (example: `20250101010101_create_users.sql`).
- Each file contains raw SQL; statements are applied in filename order.
- A `migrations` table is created in your database to track what has been applied.

## CLI usage
All commands share global options:
- `--env`: Path to the env file (default `.env`).
- `--migrations`: Path to migrations directory (default `devops/db/migrations`).
- `--auto`: Automatically confirm prompts (intended to bypass confirmations).

Common commands (run from repo root):
- Initialize tracking table:  
  `python joka.py --env .env --migrations devops/db/migrations init`
- Show migration chain/status:  
  `python joka.py --env .env --migrations devops/db/migrations status`
- Apply pending migrations (prompts before applying):  
  `python joka.py --env .env --migrations devops/db/migrations up`

## Notes / TODO
- The filesystem helpers for parsing migration file contents are still stubs.
- The CLI currently assumes MySQL/MariaDB semantics (uses `information_schema` and `AUTO_INCREMENT`).
